/* rxjs@6.6.3 */
import{_ as e,O as t,e as r,j as o,S as n}from"./rxjs-shared.min.js";import{S as s,h as i}from"./rxjs-shared.min3.js";import{R as c}from"./rxjs-shared.min4.js";import"./rxjs-shared.min8.js";var a={url:"",deserializer:function(e){return JSON.parse(e.data)},serializer:function(e){return JSON.stringify(e)}},u=function(i){function u(e,r){var n=i.call(this)||this;if(e instanceof t)n.destination=r,n.source=e;else{var u=n._config=o({},a);if(n._output=new s,"string"==typeof e)u.url=e;else for(var f in e)e.hasOwnProperty(f)&&(u[f]=e[f]);if(!u.WebSocketCtor&&WebSocket)u.WebSocketCtor=WebSocket;else if(!u.WebSocketCtor)throw new Error("no WebSocket constructor can be found");n.destination=new c}return n}return e(u,i),u.prototype.lift=function(e){var t=new u(this._config,this.destination);return t.operator=e,t.source=this,t},u.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new c),this._output=new s},u.prototype.multiplex=function(e,r,o){var n=this;return new t((function(t){try{n.next(e())}catch(e){t.error(e)}var s=n.subscribe((function(e){try{o(e)&&t.next(e)}catch(e){t.error(e)}}),(function(e){return t.error(e)}),(function(){return t.complete()}));return function(){try{n.next(r())}catch(e){t.error(e)}s.unsubscribe()}}))},u.prototype._connectSocket=function(){var e=this,t=this._config,o=t.WebSocketCtor,s=t.protocol,i=t.url,a=t.binaryType,u=this._output,f=null;try{f=s?new o(i,s):new o(i),this._socket=f,a&&(this._socket.binaryType=a)}catch(e){return void u.error(e)}var l=new n((function(){e._socket=null,f&&1===f.readyState&&f.close()}));f.onopen=function(t){if(!e._socket)return f.close(),void e._resetState();var o=e._config.openObserver;o&&o.next(t);var n=e.destination;e.destination=r.create((function(t){if(1===f.readyState)try{var r=e._config.serializer;f.send(r(t))}catch(t){e.destination.error(t)}}),(function(t){var r=e._config.closingObserver;r&&r.next(void 0),t&&t.code?f.close(t.code,t.reason):u.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),e._resetState()}),(function(){var t=e._config.closingObserver;t&&t.next(void 0),f.close(),e._resetState()})),n&&n instanceof c&&l.add(n.subscribe(e.destination))},f.onerror=function(t){e._resetState(),u.error(t)},f.onclose=function(t){e._resetState();var r=e._config.closeObserver;r&&r.next(t),t.wasClean?u.complete():u.error(t)},f.onmessage=function(t){try{var r=e._config.deserializer;u.next(r(t))}catch(e){u.error(e)}}},u.prototype._subscribe=function(e){var t=this,r=this.source;return r?r.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add((function(){var e=t._socket;0===t._output.observers.length&&(e&&1===e.readyState&&e.close(),t._resetState())})),e)},u.prototype.unsubscribe=function(){var e=this._socket;e&&1===e.readyState&&e.close(),this._resetState(),i.prototype.unsubscribe.call(this)},u}(i);function f(e){return new u(e)}export{u as WebSocketSubject,f as webSocket};
